<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<title>Flip Booklet</title>
<meta name="viewport" content="width=device-width, initial-scale=1" />
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/page-flip@2.0.7/dist/css/page-flip.css" />
<style>
:root{--bg:#0f172a;--panel:#111827;--muted:#9ca3af;--text:#e5e7eb;--accent:#60a5fa}
*{box-sizing:border-box}
html,body{margin:0;height:100%;background:var(--bg);color:var(--text);font-family:system-ui,-apple-system,Segoe UI,Roboto,Ubuntu,"Helvetica Neue",Arial;overflow:hidden}
.app{height:100%;display:grid;grid-template-rows:auto 1fr auto}
header,footer{background:var(--panel);padding:8px 12px;display:flex;justify-content:space-between;align-items:center}
header{border-bottom:1px solid #1f2937}
footer{border-top:1px solid #1f2937}
.meta{color:var(--muted);font-size:13px}
.stage{flex:1;position:relative;display:flex;align-items:center;justify-content:center}
#flipRoot{position:relative;width:100%;height:100%;display:flex;align-items:center;justify-content:center;overflow:hidden;border:1px solid #1f2937;border-radius:12px;background:#0b1220}
#book{pointer-events:none}
.nav-overlay{position:absolute;inset:0;display:grid;grid-template-rows:1fr 1fr;z-index:3}
.zone{width:100%;height:100%}
.top{cursor:n-resize}
.bottom{cursor:s-resize}
.controls{display:flex;justify-content:center;gap:10px;padding:8px}
.btn{background:#0b1220;border:1px solid #1f2937;color:var(--text);padding:8px 14px;border-radius:10px;font-weight:600;cursor:pointer}
.btn:hover{border-color:var(--accent)}
#status{position:absolute;left:10px;top:8px;font-size:13px;color:var(--muted)}
</style>
</head>
<body>
<div class="app">
<header>
  <div><strong>Flip Booklet</strong><span class="meta"> · click top/bottom to turn</span></div>
  <div class="meta" id="pageLabel">—</div>
</header>

<div class="stage">
  <div id="flipRoot">
    <div id="book"></div>
    <div id="status">Loading…</div>
    <div class="nav-overlay">
      <div class="zone top" id="zoneTop"></div>
      <div class="zone bottom" id="zoneBottom"></div>
    </div>
  </div>
</div>

<div class="controls">
  <button class="btn" id="prevBtn">▲ Prev</button>
  <button class="btn" id="fitBtn">Fit</button>
  <button class="btn" id="zoomOutBtn">–</button>
  <button class="btn" id="zoomInBtn">+</button>
  <button class="btn" id="nextBtn">Next ▼</button>
</div>

<footer>
  <span class="meta">Single page · Auto-fit · Mobile friendly</span>
  <span class="meta" id="zoomLabel">100%</span>
</footer>
</div>

<script src="https://cdnjs.cloudflare.com/ajax/libs/pdf.js/3.11.174/pdf.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/page-flip@2.0.7/dist/js/page-flip.browser.min.js"></script>
<script>
(async()=>{
const qs=new URLSearchParams(location.search);
const SRC=qs.get("src")||"your.pdf";
pdfjsLib.GlobalWorkerOptions.workerSrc="https://cdnjs.cloudflare.com/ajax/libs/pdf.js/3.11.174/pdf.worker.min.js";
const book=document.getElementById("book"),root=document.getElementById("flipRoot"),status=document.getElementById("status"),
lbl=document.getElementById("pageLabel"),zl=document.getElementById("zoomLabel");
const prev=document.getElementById("prevBtn"),next=document.getElementById("nextBtn"),
fit=document.getElementById("fitBtn"),zin=document.getElementById("zoomInBtn"),zout=document.getElementById("zoomOutBtn"),
topZ=document.getElementById("zoneTop"),botZ=document.getElementById("zoneBottom");
let pdfDoc,pageFlip,total,base={w:800,h:1131},zoom=1;
const setStatus=s=>status.textContent=s||"";
const onFlip=e=>lbl.textContent=`Page ${e.data+1} / ${total}`;
const fitTo=()=>{
  const pad=20,w=root.clientWidth-pad,h=root.clientHeight-pad;
  const s=Math.min(w/base.w,h/base.h);
  pageFlip.update({width:base.w*s*zoom,height:base.h*s*zoom,usePortrait:true,showCover:false,size:"fixed"});
};
const setZoom=z=>{zoom=Math.min(2.5,Math.max(0.5,z));zl.textContent=Math.round(zoom*100)+"%";fitTo();};
const renderPage=async(p,i)=>{
  const pg=await p.getPage(i),vp=pg.getViewport({scale:1.5*(window.devicePixelRatio||1)}),
  c=document.createElement("canvas");c.width=vp.width;c.height=vp.height;
  await pg.render({canvasContext:c.getContext("2d"),viewport:vp}).promise;
  if(i===1)base={w:c.width,h:c.height};
  return c.toDataURL("image/png");
};
try{
  setStatus("Loading PDF…");
  const buf=await(await fetch(SRC)).arrayBuffer();
  pdfDoc=await pdfjsLib.getDocument({data:buf}).promise;
  total=pdfDoc.numPages;setStatus("Rendering pages…");
  const imgs=[];for(let i=1;i<=total;i++){imgs.push(await renderPage(pdfDoc,i));if(i%3===0)setStatus(`Rendering ${i}/${total}`);}
  book.innerHTML="";pageFlip=new St.PageFlip(book,{width:base.w,height:base.h,usePortrait:true,showCover:false,size:"fixed"});
  pageFlip.loadFromImages(imgs);pageFlip.on("flip",onFlip);onFlip({data:0});fitTo();setStatus("");
  const goPrev=()=>pageFlip.flipPrev(),goNext=()=>pageFlip.flipNext();
  prev.onclick=goPrev;next.onclick=goNext;topZ.onclick=goPrev;botZ.onclick=goNext;
  fit.onclick=()=>{zoom=1;fitTo()};zin.onclick=()=>setZoom(zoom+0.1);zout.onclick=()=>setZoom(zoom-0.1);
  window.addEventListener("resize",fitTo);window.addEventListener("orientationchange",()=>setTimeout(fitTo,120));
}catch(e){console.error(e);setStatus("Failed to load PDF.");}
})();
</script>
</body>
</html>
